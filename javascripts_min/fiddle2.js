function resizeLayout(){var e=$(window).height()-100;if(e>400){var t=$("#schema-output").width();$("#schema-output").height((e-10)*.7),$("#output").css("min-height",(e-10)*.3+"px"),$("#schema_ddl").height($("#fiddleFormDDL").height()-2-8),$(window.schemaDefView.editor.getScrollerElement()).hasClass("CodeMirror-fullscreen")?($("#fiddleFormDDL .CodeMirror-scroll").css("height",$(window).height()+"px"),$("#fiddleFormDDL .CodeMirror-scroll .CodeMirror-gutter").height("height",$(window).height()+"px")):($("#fiddleFormDDL .CodeMirror-scroll").css("height",$("#fiddleFormDDL").height()-(5+$("#fiddleFormDDL .action_buttons").height())+"px"),$("#fiddleFormDDL .CodeMirror-scroll .CodeMirror-gutter").height($("#fiddleFormDDL .CodeMirror-scroll").height()-2)),$("#sql").height($("#fiddleFormSQL").height()-2-8),$(window.queryView.editor.getScrollerElement()).hasClass("CodeMirror-fullscreen")?($("#fiddleFormSQL .CodeMirror-scroll").css("height",$(window).height()+"px"),$("#fiddleFormSQL .CodeMirror-scroll .CodeMirror-gutter").css("height",$(window).height()+"px")):($("#fiddleFormSQL .CodeMirror-scroll").css("height",$("#fiddleFormSQL").height()-(5+$("#fiddleFormSQL .action_buttons").height())+"px"),$("#fiddleFormSQL .CodeMirror-scroll .CodeMirror-gutter").height($("#fiddleFormSQL .CodeMirror-scroll").height()-2)),$("#sql").width($("#fiddleFormSQL").width()-2-8),$("#schema_ddl").width($("#fiddleFormDDL").width()-2-8),$("#browser").height($("#fiddleFormDDL .CodeMirror-scroll").height());var n=function(e){var t={height:$(".blockMsg",e).height(),width:$(".blockMsg",e).width()},n={height:$(e).height(),width:$(e).width()};$(".blockMsg",e).css("top",(n.height-t.height)/2).css("left",(n.width-t.width)/2)};n($("div.sql.panel")),n($("#output")),window.schemaDefView.refresh(),window.queryView.refresh()}}$(function(){function n(e){$("#exit_fullscreen").css("display")=="none"?($("body").css("overflow-y","hidden"),$(".navbar-fixed-top").css("position","fixed"),$("#exit_fullscreen").css("display","block"),$("#exit_fullscreen span").text("Exit Fullscreen "+e),$(".nav-collapse, .btn-navbar, #db_type_label_collapsed .navbar-text").css("display","none")):($("body").css("overflow-y","auto"),$("body").css("height","100%"),$(".navbar-fixed-top").css("position",""),$("#exit_fullscreen").css("display","none"),$(".nav-collapse, .btn-navbar, #db_type_label_collapsed .navbar-text").css("display",""))}$("#userInfo").on("click","#myFiddles",function(e){e.preventDefault(),$("#myFiddlesModal").modal("show"),$("#myFiddlesModal .modal-body").block({message:"Loading..."});var t=function(){var e=$(this);$(".tab-pane",this).removeClass("active"),$($("#myFiddlesTabs li.active a").attr("href")).addClass("active"),e.unblock(),$(".preview-schema").popover({placement:"left",title:"Schema Structure",content:function(){return $(this).closest("td").find(".schemaPreviewWrapper").html()}}),$(".preview-ddl").popover({placement:"left",title:"Schema DDL",content:function(){return $(this).closest("td").find(".schemaPreviewWrapper").html()}}),$(".result-sets").popover({placement:"left",title:"Query Results",content:function(){return $(this).closest("td").find(".resultSetWrapper").html()}}),$(".preview-sql").popover({placement:"left",title:"SQL Statements",content:function(){return $(this).closest("td").find(".resultSetWrapper").html()}}),$(".showAll",this).click(function(e){e.preventDefault(),$("tr.for-schema-"+$(this).closest("tr").attr("id")).show("fast"),$(this).hide()}),$(".favorite",this).click(function(e){e.preventDefault();var n=this,r=$(this).closest("tr.queryLog");$.post("index.cfm/UserFiddles/setFavorite",{schema_def_id:$(this).attr("schema_def_id"),query_id:$(this).attr("query_id"),favorite:$(this).attr("href")=="#addFavorite"?1:0},function(){$(n).attr("href")=="#addFavorite"?$(n).attr("href","#removeFavorite").attr("title","Remove from favorites"):$(n).attr("href","#addFavorite").attr("title","Add to favorites"),$("i",n).toggleClass("icon-star-empty icon-star"),$(n).closest(".tab-pane").attr("id")=="favorites"&&$(".queryLog[schema_def_id="+$(n).attr("schema_def_id")+"][query_id="+$(n).attr("query_id")+"] a.favorite").replaceWith(n),$("#favorites").load("index.cfm/UserFiddles/getFavorites",{tz:(new Date).getTimezoneOffset()/60},t)})}),$(".forgetSchema",this).click(function(t){t.preventDefault();var n=$(this).closest("tr.schemaLog").attr("id");$.post("index.cfm/UserFiddles/forgetSchema",{schema_def_id:$(this).attr("schema_def_id")},function(){$("#"+n+",tr.for-schema-"+n,e).remove()})}),$(".forgetQuery",this).click(function(e){e.preventDefault();var t=$(this).closest("tr.queryLog");$.post("index.cfm/UserFiddles/forgetQuery",{schema_def_id:$(this).attr("schema_def_id"),query_id:$(this).attr("query_id")},function(){t.remove()})}),$(".forgetOtherQueries",this).click(function(e){e.preventDefault();var t=$(this).closest("tbody").find('tr.queryLog[schema_def_id="'+$(this).attr("schema_def_id")+'"][query_id!="'+$(this).attr("query_id")+'"]');$.post("index.cfm/UserFiddles/forgetOtherQueries",{schema_def_id:$(this).attr("schema_def_id"),query_id:$(this).attr("query_id")},function(){t.remove()})})};$("#myFiddlesModal .modal-body").load("index.cfm/UserFiddles",{tz:(new Date).getTimezoneOffset()/60},t)}),$("#myFiddlesTabs a").on("click",function(e){e.preventDefault(),$(this).tab("show")}),$("#myFiddlesModal .modal-body").on("click","a",function(e){$(this).hasClass("favorite")||$("#myFiddlesModal").modal("hide")}),$("#myFiddlesModal").on("hidden",function(){$(".popover-anchor",this).popover("hide")});if($("#user_choices",this).length){var e=[];try{fullHistory=$.parseJSON(localStorage.getItem("fiddleHistory")),fullHistory.length&&(e=_.map(fullHistory,function(e,t){return[e.fragment,dateFormat(e.last_used,"mm/dd/yyyy HH:MM:ss")]}),$.post("index.cfm/UserFiddles/loadFromLocalStorage",{localHistory:JSON.stringify(e)},function(e){var t=$.parseJSON(e);fullHistory=_.reject(fullHistory,function(e){return _.find(t,function(t){return t[0]==e.fragment})}),localStorage.setItem("fiddleHistory",JSON.stringify(fullHistory))}))}catch(t){}}$("#loginModal form").submit(function(){$("#hash",this).val(window.location.hash)}),$("#loginModal").on("hidden",function(){$("iframe").css("display","none")}),$("#userInfo").on("click","#logout",function(e){e.preventDefault(),$("<form>",{action:$(this).attr("href"),method:"GET"}).append($("<input>",{type:"hidden",name:"hash",value:window.location.hash})).submit()}),$("#textToDDLModal .btn").click(function(e){e.preventDefault();var t=(new ddl_builder({tableName:$("#tableName").val()})).setupForDBType(window.dbTypes.getSelectedType().get("simple_name")),n=t.parse($("#raw").val());$("#parseResults").text(n),$(this).attr("id")=="appendDDL"&&(window.schemaDef.set("ddl",window.schemaDef.get("ddl")+"\n\n"+n),window.schemaDef.trigger("reloaded"),$("#textToDDLModal").modal("hide"))}),$("#exit_fullscreen").on("click",function(e){e.preventDefault(),$(window.schemaDefView.editor.getScrollerElement()).removeClass("CodeMirror-fullscreen"),$(window.queryView.editor.getScrollerElement()).removeClass("CodeMirror-fullscreen"),resizeLayout(),n("")}),$("#schemaFullscreen").on("click",function(e){e.preventDefault();var t=$(window).height()-40;$(window.schemaDefView.editor.getScrollerElement()).addClass("CodeMirror-fullscreen").height(t),$(window.schemaDefView.editor.getGutterElement()).height(t),n("Schema Editor")}),$("#queryFullscreen").on("click",function(e){e.preventDefault();var t=$(window).height()-40;$(window.queryView.editor.getScrollerElement()).addClass("CodeMirror-fullscreen").height(t),$(window.queryView.editor.getGutterElement()).height(t),n("Query Editor")}),$("#schemaBrowser").on("click",function(e){e.preventDefault(),$(this).attr("disabled")||($("#fiddleFormDDL .CodeMirror, .ddl_actions").css("display","none"),$("#browser, .browser_actions").css("display","block"))}),$("#browser").on("click",".tables a",function(e){e.preventDefault(),$("i",this).toggleClass("icon-minus icon-plus"),$(this).siblings(".columns").toggle()}),$("#ddlEdit").on("click",function(e){e.preventDefault(),$("#fiddleFormDDL .CodeMirror, .ddl_actions").css("display","block"),$("#browser, .browser_actions").css("display","none")}),$(window).bind("resize",resizeLayout),setTimeout(resizeLayout,1),$(".nav").on("click","a",function(e){$(".nav-collapse.in").collapse("hide")})}),$.blockUI.defaults.overlayCSS.cursor="auto",$.blockUI.defaults.css.cursor="auto"