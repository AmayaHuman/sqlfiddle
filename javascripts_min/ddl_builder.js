ddl_builder=function(e){return this.fieldPrefix="",this.fieldSuffix="",this.tablePrefix="",this.tableSuffix="",this.dateFormatMask="yyyy-mm-dd HH:MM:ss",this.charType="varchar",this.intType="int",this.floatType="numeric",this.dateType="datetime",this.valueSeparator="",this.column_count=0,this.definition={tableName:"Table1",columns:[],data:[]},this.ddlTemplate="CREATE TABLE {{{tablePrefix}}}{{tableName}}{{{tableSuffix}}}\n	({{#each_with_index columns}}{{#if index}}, {{/if}}{{{../fieldPrefix}}}{{name}}{{{../fieldSuffix}}} {{db_type}}{{/each_with_index}});\n\nINSERT INTO {{{tablePrefix}}}{{tableName}}{{{tableSuffix}}}\n	({{#each_with_index columns}}{{#if index}}, {{/if}}{{{../fieldPrefix}}}{{name}}{{{../fieldSuffix}}}{{/each_with_index}})\nVALUES\n	{{#each_with_index data}}{{#if index}},\n	{{/if}}({{#each_with_index r}}{{#if index}}, {{/if}}{{formatted_field ../..}}{{/each_with_index}}){{/each_with_index}};",this.compiledTemplate=Handlebars.compile(this.ddlTemplate),this.setup(e),this},ddl_builder.prototype.setup=function(e){for(opt in e)this[opt]=e[opt];return e.ddlTemplate&&(this.compiledTemplate=Handlebars.compile(this.ddlTemplate)),e.tableName&&(this.definition.tableName=e.tableName),this},ddl_builder.prototype.setupForDBType=function(e){switch(e){case"SQL Server":this.setup({fieldPrefix:"[",fieldSuffix:"]",tablePrefix:"[",tableSuffix:"]"});break;case"MySQL":this.setup({fieldPrefix:"`",fieldSuffix:"`",tablePrefix:"`",tableSuffix:"`"});break;case"PostgreSQL":this.setup({fieldPrefix:'"',fieldSuffix:'"'});break;case"Oracle":var t="CREATE TABLE {{{tablePrefix}}}{{tableName}}{{{tableSuffix}}}\n	({{#each_with_index columns}}{{#if index}}, {{/if}}{{{../fieldPrefix}}}{{name}}{{{../fieldSuffix}}} {{db_type}}{{/each_with_index}})\n/\nINSERT ALL{{#each_with_index data}}\n	INTO {{{../tablePrefix}}}{{../tableName}}{{{../tableSuffix}}} ({{#each_with_index r}}{{#if index}}, {{/if}}{{{../../fieldPrefix}}}{{column_name_for_index ../..}}{{{../../fieldSuffix}}}{{/each_with_index}})\n	     VALUES ({{#each_with_index r}}{{#if index}}, {{/if}}{{formatted_field ../..}}{{/each_with_index}}){{/each_with_index}}\nSELECT * FROM dual";this.setup({ddlTemplate:t,dateType:"timestamp",charType:"varchar2",fieldPrefix:'"',fieldSuffix:'"'});break;case"SQLite":var t="CREATE TABLE {{tablePrefix}}{{tableName}}{{tableSuffix}}\n	({{#each_with_index columns}}{{#if index}}, {{/if}}{{../fieldPrefix}}{{name}}{{../fieldSuffix}} {{db_type}}{{/each_with_index}});\n\n{{#each_with_index data}}INSERT INTO {{tablePrefix}}{{../tableName}}{{tableSuffix}}\n	({{#each_with_index ../columns}}{{#if index}}, {{/if}}{{../fieldPrefix}}{{name}}{{../fieldSuffix}}{{/each_with_index}})\nVALUES\n	({{#each_with_index r}}{{#if index}}, {{/if}}{{formatted_field ../..}}{{/each_with_index}});\n{{/each_with_index}}";this.setup({ddlTemplate:t,dateType:"TEXT",charType:"TEXT",intType:"INTEGER",floatType:"REAL"})}return this},ddl_builder.prototype.populateDBTypes=function(){for(var e=0;e<this.definition.columns.length;e++)this.definition.columns[e].type=="charType"?this.definition.columns[e].db_type=this[this.definition.columns[e].type]+"("+this.definition.columns[e].length+")":this.definition.columns[e].db_type=this[this.definition.columns[e].type];this.definition.dateFormatMask=this.dateFormatMask},ddl_builder.prototype.populateWrappers=function(){this.definition.fieldPrefix=this.fieldPrefix,this.definition.fieldSuffix=this.fieldSuffix},ddl_builder.prototype.guessValueSeparator=function(e){var t=e.split("\n"),n=!1,r=0,i="";for(var s=0;s<t.length;s++)if(t[s].search(/[A-Z0-9_]/i)!=-1&&!n){var o=$.trim(t[s]).match(/[A-Z0-9_]+([^A-Z0-9_]*)/gi);n=!0;for(var u=0;u<o.length;u++){var a=o[u].match(/[A-Z0-9_]+([^A-Z0-9_]*)$/i)[1];a.search(/^\s+$/)!=-1?a=new RegExp("\\s+"):a=$.trim(a);if(a instanceof RegExp||a.length)if(i instanceof RegExp||!!i.length){if(i.toString()!=a.toString())return{status:!1,message:"Unable to find consistent column separator in header row"}}else i=a;else!(a instanceof RegExp)&&!(i instanceof RegExp)&&!i.length&&(i="\n")}i instanceof RegExp||i.length?r=t[s].split(i).length:r=1}else if(t[s].search(/[A-Z0-9_]/i)!=-1&&t[s].split(i).length!=r)return{status:!1,message:"Line "+s+' does not have the same number of columns as the header, based on separator "'+i+'".'};return{status:!0,separator:i,column_count:r}},ddl_builder.prototype.parse=function(e){if(!this.valueSeparator.length){var t=this.guessValueSeparator(e);if(!t.status)return"ERROR! "+t.message;this.column_count=t.column_count,this.valueSeparator=t.separator}var n=e.split("\n");for(var r=0;r<n.length;r++)if($.trim(n[r]).length&&n[r].split(this.valueSeparator).length==this.column_count){var i=$.trim(n[r]).split(this.valueSeparator);if(!this.definition.columns.length)for(var s=0;s<i.length;s++){var o=$.trim(i[s]);o.length?this.definition.columns.push({name:o}):this.definition.columns.push(!1)}else{var u=[];for(var s=0;s<i.length;s++)if(this.definition.columns[s]!==!1){var o=$.trim(i[s]).replace(/'/g,"''");isNaN(o)||this.definition.columns[s].type=="dateType"||this.definition.columns[s].type=="charType"?this.definition.columns[s].type!="charType"&&!isNaN(Date.parse(o))?this.definition.columns[s].type="dateType":this.definition.columns[s].type="charType":this.definition.columns[s].type!="floatType"&&o%1!=0?this.definition.columns[s].type="floatType":this.definition.columns[s].type="intType";if(!this.definition.columns[s].length||o.length>this.definition.columns[s].length)this.definition.columns[s].length=o.length;u.push({v:o})}this.definition.data.push({r:u})}}return this.populateDBTypes(),this.populateWrappers(),this.render()},Handlebars.registerHelper("formatted_field",function(e){var t="",n=-1;for(var r=0;r<e.columns.length;r++){e.columns[r]&&n++;if(n==this.index){t=e.columns[r].type;break}}return!this.v.length||this.v.toUpperCase()=="NULL"?"NULL":t=="charType"?new Handlebars.SafeString("'"+this.v.replace(/'/g,"''")+"'"):t=="dateType"?new Handlebars.SafeString("'"+dateFormat(this.v,e.dateFormatMask)+"'"):this.v}),Handlebars.registerHelper("column_name_for_index",function(e){return e.columns[this.index].name}),Handlebars.registerHelper("each_with_index",function(e,t){var n="";k=0;for(var r=0,i=e.length;r<i;r++)if(e[r]){var s=e[r];s.index=k,s.first=k==0,s.last=k==e.length,n+=t(s),k++}return n}),ddl_builder.prototype.render=function(){return this.compiledTemplate(this.definition)}